import "pe"
rule Gh0stRAT_DDOS_Variant {
   meta:
            description = "Gh0stRAT Variant"
            author = "James Quinn @LazyActivist192"
            date = "2019-04-05"
            hash1 = "f1cd38bbb504b38d115b5c127afa913572cef4233395416b5b08aff5f718cfea"
   strings:
            $s1 = "User-Agent:Mozilla/4.0 (compatible; MSIE 6.00; Windows NT 5.0; MyIE 3.01)" fullword ascii
            $s2 = "User-Agent:Mozilla/4.0 (compatible; MSIE 7.00; Windows NT 5.1; MyIE 3.01)" fullword ascii
            $s3 = "User-Agent:Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)" fullword ascii
            $s4 = "User-Agent:Mozilla/5.0 (X11; U; Linux i686; en-US; re:1.4.0) Gecko/20080808 Firefox/8.0" fullword ascii
            $s5 = "aPPLICATIONS\\IEXPLORE.EXE\\SHELL\\OPEN\\COMMAND" fullword ascii
            $s6 = "NetService.exe" fullword ascii
            $s7 = "MSVCP60.dll" fullword ascii
            $s8 = "\\CMD.EXE" fullword ascii
            $s9 = "360tary.exe" fullword ascii
            $s10 = "MFC42.DLL" fullword ascii
            $s11 = "%s\\SHELL\\OPEN\\COMMAND" fullword ascii
            $s12 = "360sd.exe" fullword ascii
            $s13 = "Winlogon" fullword ascii
            $s14 = "system\\cURRENTcONTROLsET\\sERVICES\\%s" fullword ascii
            $s15 = "SYSTEM\\CurrentControlSet\\Services\\TermService" fullword ascii
            $s16 = "SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp" fullword ascii
            $s17 = "SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\Wds\\rdpwd\\Tds\\tcp" fullword ascii
            $s18 = "Mozilla/4.0 (compatible)" fullword ascii
            $s19 = "SYSTEM\\CurrentControlSet\\Services\\TermDD" fullword ascii
            $s20 = "SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\RDPTcp" fullword ascii
   condition:
            uint16(0) == 0x5a4d and filesize < 400KB and
            ( pe.imphash() == "90951b36f29a0f78c9e88cebc58ea5a6" or 8 of them )
}